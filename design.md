# Signal â€” è©³ç´°è¨­è¨ˆæ›¸

## 1. å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1.1 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Signal Application                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Presentation Layer                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ UI Components                                                   â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚ â”‚ Header  â”‚ â”‚ ChatArea    â”‚ â”‚SignalPanel  â”‚ â”‚ControlArea    â”‚  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚â”‚
â”‚  â”‚                     â”‚ FullscreenOverlay   â”‚                     â”‚â”‚
â”‚  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Application Layer                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚â”‚
â”‚  â”‚ â”‚ AppState     â”‚ â”‚ EventBus     â”‚ â”‚ MessageService  â”‚          â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Domain Layer                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚â”‚
â”‚  â”‚ â”‚ Protocol     â”‚ â”‚ BitReceiver  â”‚ â”‚ Message         â”‚          â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Channel Layer                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚â”‚
â”‚  â”‚ â”‚Ultrasonic â”‚ â”‚ Audible   â”‚ â”‚Brightness â”‚ â”‚  Color    â”‚        â”‚â”‚
â”‚  â”‚ â”‚ Channel   â”‚ â”‚ Channel   â”‚ â”‚ Channel   â”‚ â”‚ Channel   â”‚        â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚â”‚
â”‚  â”‚ â”‚  Grid     â”‚ â”‚    QR     â”‚                                    â”‚â”‚
â”‚  â”‚ â”‚ Channel   â”‚ â”‚ Channel   â”‚                                    â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚â”‚
â”‚  â”‚ â”‚ AudioManager  â”‚ â”‚ VideoManager  â”‚ â”‚CanvasManager  â”‚          â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  External Libraries (Inlined)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ jsQR 1.4.0    â”‚ â”‚ qrcode-generator   â”‚                          â”‚
â”‚  â”‚               â”‚ â”‚ 1.4.4              â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼è²¬å‹™å®šç¾©

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | è²¬å‹™ | ä¾å­˜æ–¹å‘ |
|---------|------|---------|
| Presentation | UIæç”»ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å‡¦ç† | Application ã¸ä¾å­˜ |
| Application | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã€çŠ¶æ…‹ç®¡ç† | Domain, Channel ã¸ä¾å­˜ |
| Domain | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«å‡¦ç† | Infrastructure ã¸ä¾å­˜ |
| Channel | å„é€šä¿¡ãƒãƒ£ãƒãƒ«ã®å®Ÿè£… | Domain, Infrastructure ã¸ä¾å­˜ |
| Infrastructure | ãƒ–ãƒ©ã‚¦ã‚¶APIæŠ½è±¡åŒ– | å¤–éƒ¨APIã®ã¿ |

---

## 2. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«/ã‚¯ãƒ©ã‚¹æ§‹æˆ

### 2.1 ã‚¯ãƒ©ã‚¹å›³

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   <<interface>> â”‚
                          â”‚    IChannel     â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚+id: ChannelId   â”‚
                          â”‚+name: string    â”‚
                          â”‚+description: strâ”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚+send(msg)       â”‚
                          â”‚+startReceive()  â”‚
                          â”‚+stopReceive()   â”‚
                          â”‚+getVisualizer() â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚           â”‚           â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚AudioChannel   â”‚â”‚BrightnessCâ”‚â”‚ColorChanâ”‚â”‚GridChannelâ”‚â”‚ QRChannel     â”‚
â”‚<<abstract>>   â”‚â”‚           â”‚â”‚         â”‚â”‚           â”‚â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚#audioManager  â”‚â”‚#videoMgr  â”‚â”‚#videoMgrâ”‚â”‚#videoMgr  â”‚â”‚#videoMgr      â”‚
â”‚#analyser      â”‚â”‚#threshold â”‚â”‚         â”‚â”‚#cells     â”‚â”‚#lastQR        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚+sendTone()    â”‚â”‚+detectBit â”‚â”‚+detectC â”‚â”‚+readGrid  â”‚â”‚+displayQR()   â”‚
â”‚+detectFreq()  â”‚â”‚           â”‚â”‚         â”‚â”‚           â”‚â”‚+scanQR()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚UltrasonicChan â”‚â”‚ AudibleChannelâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚FREQ_0=18000   â”‚â”‚FREQ_0=800     â”‚
â”‚FREQ_1=19000   â”‚â”‚FREQ_1=1600    â”‚
â”‚PILOT=17000    â”‚â”‚PILOT=400      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ãƒ•ã‚¡ã‚¤ãƒ« | è²¬å‹™ |
|-----------|---------|------|
| Constants | src/constants/index.ts | å®šæ•°å®šç¾©ï¼ˆå‘¨æ³¢æ•°ã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç­‰ï¼‰ |
| Types | src/types/index.ts | å‹å®šç¾©ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ |
| Protocol | src/domain/protocol.ts | ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ãƒ­ã‚¸ãƒƒã‚¯ |
| BitReceiver | src/domain/bit-receiver.ts | ãƒ“ãƒƒãƒˆå—ä¿¡ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ |
| AudioManager | src/infrastructure/audio-manager.ts | Web Audio APIæ“ä½œ |
| VideoManager | src/infrastructure/video-manager.ts | getUserMedia(video)æ“ä½œ |
| CanvasManager | src/infrastructure/canvas-manager.ts | Canvasæç”»æ“ä½œ |
| UltrasonicChannel | src/channels/ultrasonic-channel.ts | è¶…éŸ³æ³¢ãƒãƒ£ãƒãƒ« |
| AudibleChannel | src/channels/audible-channel.ts | å¯è´éŸ³ãƒãƒ£ãƒãƒ« |
| BrightnessChannel | src/channels/brightness-channel.ts | ç”»é¢æ˜æ»…ãƒãƒ£ãƒãƒ« |
| ColorChannel | src/channels/color-channel.ts | è‰²å¤‰èª¿ãƒãƒ£ãƒãƒ« |
| GridChannel | src/channels/grid-channel.ts | ç©ºé–“ã‚°ãƒªãƒƒãƒ‰ãƒãƒ£ãƒãƒ« |
| QRChannel | src/channels/qr-channel.ts | QRã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒãƒ« |
| AppState | src/application/store.ts | ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç† |
| EventBus | src/application/event-bus.ts | ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ |
| MessageService | src/application/message-service.ts | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç† |
| UIComponents | src/ui/components/*.ts | UIæç”» |
| App | src/main.ts | åˆæœŸåŒ–ã¨çµ±åˆ |

---

## 3. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©

### 3.1 ãƒãƒ£ãƒãƒ«é–¢é€£å‹

```typescript
// ãƒãƒ£ãƒãƒ«IDå‹
type ChannelId = 'ultrasonic' | 'audible' | 'brightness' | 'color' | 'grid' | 'qr';

// ãƒãƒ£ãƒãƒ«è¨­å®š
interface ChannelConfig {
  readonly id: ChannelId;
  readonly name: string;
  readonly description: string;
  readonly pilotMs: number;
  readonly gapMs: number;
  readonly bitMs?: number;
  readonly frameMs?: number;
}

// ãƒãƒ£ãƒãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
interface IChannel {
  readonly config: ChannelConfig;

  send(message: string): Promise<void>;
  startReceive(): Promise<void>;
  stopReceive(): void;
  getVisualizer(): IVisualizer;
  isReceiving(): boolean;
  isSending(): boolean;
}

// ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
interface IVisualizer {
  draw(canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D): void;
  getPreferredHeight(): number;
}
```

### 3.2 ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯/ã‚¤ãƒ™ãƒ³ãƒˆå‹

```typescript
// å—ä¿¡ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
interface ReceiverCallbacks {
  onMessage: (message: string) => void;
  onError: (error: ReceiverError) => void;
  onStatusChange: (status: ReceiverStatus) => void;
}

// å—ä¿¡çŠ¶æ…‹
type ReceiverStatus =
  | { state: 'idle' }
  | { state: 'pilot' }
  | { state: 'gap' }
  | { state: 'receiving'; progress: number }
  | { state: 'success' }
  | { state: 'error'; message: string };

// ã‚¨ãƒ©ãƒ¼å‹
interface ReceiverError {
  type: 'checksum' | 'timeout' | 'permission' | 'decode';
  message: string;
}
```

### 3.3 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹

```typescript
type MessageDirection = 'sent' | 'received' | 'system';

interface ChatMessage {
  id: string;
  direction: MessageDirection;
  content: string;
  channel?: ChannelId;
  timestamp: Date;
}
```

### 3.4 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹å‹

```typescript
interface AppState {
  currentChannel: ChannelId;
  isReceiving: boolean;
  isSending: boolean;
  messages: ChatMessage[];
  signalPanelState: 'collapsed' | 'open' | 'expanded';
  receiverStatus: ReceiverStatus;
  inputText: string;
}
```

---

## 4. çŠ¶æ…‹ç®¡ç†è¨­è¨ˆ

### 4.1 Store ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
class Store<T> {
  private state: T;
  private listeners: Set<(state: T) => void> = new Set();

  constructor(initialState: T) {
    this.state = initialState;
  }

  getState(): T {
    return this.state;
  }

  setState(updater: (prev: T) => T): void {
    this.state = updater(this.state);
    this.notify();
  }

  subscribe(listener: (state: T) => void): () => void {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  }

  private notify(): void {
    this.listeners.forEach(listener => listener(this.state));
  }
}
```

### 4.2 ãƒ“ãƒƒãƒˆå—ä¿¡ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  idle   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                         â”‚
             â”‚ detectPilot() === true                       â”‚
             â–¼                                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
        â”‚  pilot  â”‚                                         â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                         â”‚
             â”‚ detectPilot() === false                      â”‚
             â–¼                                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
        â”‚   gap   â”‚                                         â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                         â”‚
             â”‚ elapsed >= GAP_MS Ã— 0.6                      â”‚
             â–¼                                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
        â”‚  bits   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  decode success / decode fail /         â”‚
                     bits > 2000 (timeout)                  â”‚
```

| çŠ¶æ…‹ | é·ç§»æ¡ä»¶ | å‹•ä½œ |
|------|----------|------|
| `idle` | ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆæ¤œå‡ºé–¢æ•°ãŒtrueã‚’è¿”ã™ | `pilot`ã¸é·ç§» |
| `pilot` | ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆæ¤œå‡ºé–¢æ•°ãŒfalseã«å¤‰ã‚ã‚‹ | `gap`ã¸é·ç§»ã€ã‚®ãƒ£ãƒƒãƒ—é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ² |
| `gap` | ã‚®ãƒ£ãƒƒãƒ—é–‹å§‹ã‹ã‚‰ GAP_MS Ã— 0.6 ä»¥ä¸ŠçµŒé | `bits`ã¸é·ç§» |
| `bits` | bitMs + guardMs é–“éš”ã§ãƒ“ãƒƒãƒˆåˆ¤å®š | å¿…è¦ãƒ“ãƒƒãƒˆæ•°ãŒæƒã£ãŸã‚‰ãƒ‡ã‚³ãƒ¼ãƒ‰ |
| `bits` | ãƒ‡ã‚³ãƒ¼ãƒ‰æˆåŠŸ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‘¼ã³idleã¸ |
| `bits` | ãƒ‡ã‚³ãƒ¼ãƒ‰å¤±æ•— | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‘¼ã³idleã¸ |
| `bits` | è“„ç©ãƒ“ãƒƒãƒˆæ•°ãŒ2000ã‚’è¶…ãˆã‚‹ | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¨ã—ã¦idleã¸ |

---

## 5. å„ãƒãƒ£ãƒãƒ«ã®è©³ç´°å®Ÿè£…è¨­è¨ˆ

### 5.1 éŸ³å£°ãƒãƒ£ãƒãƒ«å…±é€šè¨­è¨ˆ

#### 5.1.1 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ultrasonic | audible |
|-----------|------------|---------|
| PILOT_FREQ | 17,000 Hz | 400 Hz |
| FREQ_0 | 18,000 Hz | 800 Hz |
| FREQ_1 | 19,000 Hz | 1,600 Hz |
| BIT_MS | 100 ms | 70 ms |
| GUARD_MS | 8 ms | 8 ms |
| THRESHOLD_DB | -42 dB | -40 dB |
| FFT_SIZE | 8192 | 8192 |

#### 5.1.2 é€ä¿¡ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”
â”‚   Pilot    â”‚ â”‚Gap â”‚ â”‚P0 â”‚â”‚P1 â”‚â”‚P2 â”‚â”‚P3 â”‚â”‚P4 â”‚â”‚P5 â”‚â”‚P6 â”‚â”‚P7 â”‚ ...
â”‚  700ms     â”‚ â”‚300 â”‚ â”‚bitâ”‚â”‚bitâ”‚â”‚bitâ”‚â”‚bitâ”‚â”‚bitâ”‚â”‚bitâ”‚â”‚bitâ”‚â”‚bitâ”‚
â”‚  17kHz     â”‚ â”‚ ms â”‚ â”‚+G â”‚â”‚+G â”‚â”‚+G â”‚â”‚+G â”‚â”‚+G â”‚â”‚+G â”‚â”‚+G â”‚â”‚+G â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜
                      â–²
                      â”‚
             Preamble: 10101010
             Marker:   11111111
             Length:   8 bits
             Data:     N Ã— 8 bits
             Checksum: 8 bits
```

#### 5.1.3 FFTè§£æ

```typescript
// å‘¨æ³¢æ•°â†’FFTãƒ“ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å¤‰æ›
// binIndex = frequency Ã— fftSize / sampleRate

// ä¾‹: sampleRate=48000, fftSize=8192
// 17kHz â†’ bin 2901
// 18kHz â†’ bin 3072
// 19kHz â†’ bin 3243
```

#### 5.1.4 FSKé€ä¿¡ã‚¯ãƒ©ã‚¹

```typescript
class FSKTransmitter {
  private config: FSKChannelConfig;
  private context: AudioContext | null = null;

  async transmit(bits: number[]): Promise<void> {
    this.context = new AudioContext();
    const gainNode = this.context.createGain();
    gainNode.connect(this.context.destination);

    let currentTime = this.context.currentTime;

    // 1. ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆä¿¡å·
    currentTime = this.scheduleTone(
      gainNode, this.config.pilotFrequency,
      currentTime, this.config.pilotDurationMs
    );

    // 2. ã‚®ãƒ£ãƒƒãƒ—
    currentTime += this.config.gapDurationMs / 1000;

    // 3. ãƒ“ãƒƒãƒˆåˆ—
    for (const bit of bits) {
      const freq = bit === 0 ? this.config.freq0 : this.config.freq1;
      currentTime = this.scheduleTone(gainNode, freq, currentTime, this.config.bitDurationMs);
      currentTime += this.config.guardIntervalMs / 1000;
    }

    // å®Œäº†å¾…æ©Ÿå¾Œã‚¯ãƒ­ãƒ¼ã‚º
    await this.waitAndClose(currentTime);
  }

  private scheduleTone(gainNode: GainNode, frequency: number, startTime: number, durationMs: number): number {
    const osc = this.context!.createOscillator();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(frequency, startTime);
    osc.connect(gainNode);

    const endTime = startTime + durationMs / 1000;
    const ramp = 0.002; // ã‚¯ãƒªãƒƒã‚¯ãƒã‚¤ã‚ºè»½æ¸›

    gainNode.gain.setValueAtTime(0, startTime);
    gainNode.gain.linearRampToValueAtTime(0.5, startTime + ramp);
    gainNode.gain.setValueAtTime(0.5, endTime - ramp);
    gainNode.gain.linearRampToValueAtTime(0, endTime);

    osc.start(startTime);
    osc.stop(endTime);

    return endTime;
  }
}
```

#### 5.1.5 FSKå—ä¿¡ã‚¯ãƒ©ã‚¹

```typescript
class FSKReceiver {
  private analyser: AnalyserNode;
  private frequencyData: Float32Array;

  detectPilot(): boolean {
    this.analyser.getFloatFrequencyData(this.frequencyData);
    const binIndex = this.frequencyToBin(this.config.pilotFrequency);
    return this.frequencyData[binIndex] >= this.config.detectionThresholdDb;
  }

  detectBit(): 0 | 1 | null {
    this.analyser.getFloatFrequencyData(this.frequencyData);
    const power0 = this.frequencyData[this.frequencyToBin(this.config.freq0)];
    const power1 = this.frequencyData[this.frequencyToBin(this.config.freq1)];

    if (Math.max(power0, power1) < this.config.detectionThresholdDb) {
      return null;
    }
    return power1 > power0 ? 1 : 0;
  }

  private frequencyToBin(frequency: number): number {
    return Math.round((frequency * this.config.fftSize) / this.sampleRate);
  }
}
```

### 5.2 è¦–è¦šãƒãƒ£ãƒãƒ«å…±é€šè¨­è¨ˆ

#### 5.2.1 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | brightness | color |
|-----------|------------|-------|
| BIT_MS | 250 ms | 280 ms |
| PILOT_COLOR | #FFFFFF (ç™½) | #0000FF (é’) |
| BIT_0_COLOR | #000000 (é»’) | #FF0000 (èµ¤) |
| BIT_1_COLOR | #FFFFFF (ç™½) | #00FF00 (ç·‘) |
| THRESHOLD | calibration + 40 | R/Gæ¯”è¼ƒ |

#### 5.2.2 è¼åº¦è¨ˆç®—

```typescript
function calculateLuminance(imageData: ImageData, region: SamplingRegion): number {
  const { data, width } = imageData;
  let sum = 0;
  let count = 0;

  for (let y = region.y; y < region.y + region.height; y += region.step) {
    for (let x = region.x; x < region.x + region.width; x += region.step) {
      const i = (y * width + x) * 4;
      // ITU-R BT.709 è¼åº¦è¨ˆç®—å¼
      const luminance = 0.2126 * data[i] + 0.7152 * data[i + 1] + 0.0722 * data[i + 2];
      sum += luminance;
      count++;
    }
  }

  return count > 0 ? sum / count : 0;
}
```

#### 5.2.3 RGBè¨ˆç®—ï¼ˆcolorãƒãƒ£ãƒãƒ«ç”¨ï¼‰

```typescript
function calculateAverageRGB(imageData: ImageData, region: SamplingRegion): { r: number; g: number; b: number } {
  const { data, width } = imageData;
  let sumR = 0, sumG = 0, sumB = 0;
  let count = 0;

  for (let y = region.y; y < region.y + region.height; y += region.step) {
    for (let x = region.x; x < region.x + region.width; x += region.step) {
      const i = (y * width + x) * 4;
      sumR += data[i];
      sumG += data[i + 1];
      sumB += data[i + 2];
      count++;
    }
  }

  return { r: sumR / count, g: sumG / count, b: sumB / count };
}

// ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆæ¤œå‡ºï¼ˆé’ï¼‰
function detectBluePilot(rgb: { r: number; g: number; b: number }): boolean {
  return rgb.b > 100 && rgb.b > rgb.r * 1.3 && rgb.b > rgb.g * 1.3;
}
```

#### 5.2.4 ä¸­å¤®é ˜åŸŸã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°

```typescript
// ç”»é¢ä¸­å¤®20%ã®æ­£æ–¹å½¢é ˜åŸŸ
function getCenterRegion(imageWidth: number, imageHeight: number): SamplingRegion {
  const size = Math.min(imageWidth, imageHeight) * 0.2;
  return {
    x: Math.floor((imageWidth - size) / 2),
    y: Math.floor((imageHeight - size) / 2),
    width: Math.floor(size),
    height: Math.floor(size),
    step: 2  // 2ãƒ”ã‚¯ã‚»ãƒ«é–“éš”
  };
}
```

### 5.3 ã‚°ãƒªãƒƒãƒ‰ãƒãƒ£ãƒãƒ«è¨­è¨ˆ

#### 5.3.1 4Ã—4ã‚°ãƒªãƒƒãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°

```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ B0 â”‚ B1 â”‚ B2 â”‚ B3 â”‚  â† High byte (bits 7-0)
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ B4 â”‚ B5 â”‚ B6 â”‚ B7 â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚ B8 â”‚ B9 â”‚B10 â”‚B11 â”‚  â† Low byte (bits 7-0)
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
â”‚B12 â”‚B13 â”‚B14 â”‚B15 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜

Cell Index = row Ã— 4 + col
1ãƒ•ãƒ¬ãƒ¼ãƒ  = 16ãƒ“ãƒƒãƒˆ = 2ãƒã‚¤ãƒˆ
```

#### 5.3.2 ãƒ•ãƒ¬ãƒ¼ãƒ æ§‹é€ 

```
[Pilot: å…¨ç™½ 800ms] â†’ [Gap: å…¨é»’ 400ms] â†’ [Data Frames 400ms each] â†’ [Checkerboard 500ms]

ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰: [ãƒ‡ãƒ¼ã‚¿é•·(1byte)][ãƒ‡ãƒ¼ã‚¿æœ¬ä½“(N bytes)][XORãƒã‚§ãƒƒã‚¯ã‚µãƒ (1byte)]
â€» å¥‡æ•°ãƒã‚¤ãƒˆã®å ´åˆã¯0x00ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
```

#### 5.3.3 ãƒã‚§ãƒƒã‚«ãƒ¼ãƒœãƒ¼ãƒ‰æ¤œå‡º

```typescript
function isCheckerboard(bits: number[], tolerance: number = 0.75): boolean {
  let matchCount = 0;
  for (let row = 0; row < 4; row++) {
    for (let col = 0; col < 4; col++) {
      const index = row * 4 + col;
      const expected = (row + col) % 2;
      if (bits[index] === expected) matchCount++;
    }
  }
  return matchCount / 16 >= tolerance;  // 75%ä»¥ä¸Šã§è¨±å®¹
}
```

### 5.4 QRãƒãƒ£ãƒãƒ«è¨­è¨ˆ

#### 5.4.1 é€ä¿¡ãƒ•ãƒ­ãƒ¼

```typescript
class QRTransmitter {
  async displayQR(message: string): Promise<void> {
    // qrcode-generatorä½¿ç”¨
    const qr = qrcode(0, 'M');  // ã‚¨ãƒ©ãƒ¼è¨‚æ­£ãƒ¬ãƒ™ãƒ«M (15%)
    qr.addData(message);
    qr.make();

    // ç”»é¢çŸ­è¾ºã®85%ã‚µã‚¤ã‚ºã§è¡¨ç¤º
    const size = Math.min(window.innerWidth, window.innerHeight) * 0.85;

    // 3ç§’é–“è¡¨ç¤º
    overlay.show();
    overlay.drawQR(qr.modules, qr.getModuleCount());
    await sleep(3000);
    overlay.hide();
  }
}
```

#### 5.4.2 å—ä¿¡ãƒ•ãƒ­ãƒ¼

```typescript
class QRReceiver {
  private lastDecodedData: string = '';

  processFrame(imageData: ImageData): void {
    const code = jsQR(imageData.data, imageData.width, imageData.height);

    if (code && code.data !== this.lastDecodedData) {
      this.lastDecodedData = code.data;
      this.onMessage(code.data);

      // å››éš…ã‚’ç·‘æ ã§è¡¨ç¤º
      this.drawCorners(code.location);
    }
  }
}
```

---

## 6. UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 6.1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆéšå±¤

```
App
â”œâ”€â”€ Header
â”‚   â”œâ”€â”€ AppTitle
â”‚   â””â”€â”€ ChannelSelector
â”‚       â””â”€â”€ ChannelButton (Ã—6)
â”œâ”€â”€ ChatArea
â”‚   â””â”€â”€ ChatMessage (Ã—N)
â”œâ”€â”€ SignalPanel
â”‚   â”œâ”€â”€ PanelHeader
â”‚   â”‚   â”œâ”€â”€ ChannelName
â”‚   â”‚   â””â”€â”€ StatusMessage
â”‚   â””â”€â”€ VisualizationCanvas
â””â”€â”€ ControlArea
    â”œâ”€â”€ MessageInput
    â”œâ”€â”€ SendButton
    â””â”€â”€ ReceiveToggleButton
```

### 6.2 å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ˜ãƒƒãƒ€ãƒ¼                 â”‚ â† å›ºå®šã€ãƒãƒ£ãƒãƒ«é¸æŠ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚ ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢            â”‚ â† ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½
â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã‚·ã‚°ãƒŠãƒ«ãƒ‘ãƒãƒ«            â”‚ â† å±•é–‹/æŠ˜ç•³ã¿å¯èƒ½
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«              â”‚ â† å›ºå®šã€å…¥åŠ›ãƒ»é€ä¿¡ãƒ»å—ä¿¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 ã‚·ã‚°ãƒŠãƒ«ãƒ‘ãƒãƒ«çŠ¶æ…‹

| çŠ¶æ…‹ | é«˜ã• | ç”¨é€” |
|------|------|------|
| collapsed | 0px | éè¡¨ç¤º |
| open | 180px | éŸ³å£°ãƒãƒ£ãƒãƒ«å—ä¿¡/é€ä¿¡æ™‚ |
| expanded | 260px | è¦–è¦šãƒãƒ£ãƒãƒ«ï¼ˆã‚«ãƒ¡ãƒ©æ˜ åƒè¡¨ç¤ºï¼‰ |

### 6.4 å…¨ç”»é¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤

```typescript
class SignalOverlay {
  show(onCancel?: () => void): void;
  hide(): void;
  setStatus(message: string): void;
  fillColor(color: string): void;      // brightness/colorãƒãƒ£ãƒãƒ«ç”¨
  drawGrid(bits: number[]): void;      // gridãƒãƒ£ãƒãƒ«ç”¨
  drawQR(modules: boolean[][], count: number): void;  // qrãƒãƒ£ãƒãƒ«ç”¨
}
```

### 6.5 CSSè¨­è¨ˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼‰

```css
:root {
  /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
  --color-bg: #1a1a2e;
  --color-surface: #16213e;
  --color-surface-raised: #1f3460;
  --color-primary: #4361ee;
  --color-primary-light: #4cc9f0;
  --color-accent: #f72585;
  --color-text: #edf2f4;
  --color-text-muted: #8d99ae;

  /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ©ãƒ¼ */
  --color-sent: #4361ee;
  --color-received: #2a9d8f;
  --color-system: #6c757d;

  /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
  --header-height: 100px;
  --control-height: 64px;
  --signal-panel-collapsed: 0px;
  --signal-panel-open: 180px;
  --signal-panel-expanded: 260px;

  /* Safe Area (iOSç”¨) */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);

  /* é–“éš” */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;

  /* è§’ä¸¸ */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 16px;
  --radius-full: 9999px;
}

*, *::before, *::after {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--color-bg);
  color: var(--color-text);
  -webkit-text-size-adjust: 100%;
}

body {
  display: flex;
  flex-direction: column;
  max-width: 480px;
  margin: 0 auto;
  height: 100vh;
  height: 100dvh;
  overflow: hidden;
}

/* iOS Safari ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
@supports not (height: 100dvh) {
  body {
    height: -webkit-fill-available;
  }
}
```

---

## 7. ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

### 7.1 é–‹ç™ºæ™‚æ§‹æˆ

```
signal/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ index.ts              # å‹å®šç¾©ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ channel.ts            # ãƒãƒ£ãƒãƒ«é–¢é€£å‹
â”‚   â”‚   â”œâ”€â”€ message.ts            # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–¢é€£å‹
â”‚   â”‚   â””â”€â”€ state.ts              # çŠ¶æ…‹é–¢é€£å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â””â”€â”€ index.ts              # å®šæ•°å®šç¾©
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ protocol.ts           # ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰
â”‚   â”‚   â””â”€â”€ bit-receiver.ts       # ãƒ“ãƒƒãƒˆå—ä¿¡ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”œâ”€â”€ audio-manager.ts      # Web Audio APIæ“ä½œ
â”‚   â”‚   â”œâ”€â”€ video-manager.ts      # ã‚«ãƒ¡ãƒ©/æ˜ åƒæ“ä½œ
â”‚   â”‚   â””â”€â”€ canvas-manager.ts     # Canvasæç”»æ“ä½œ
â”‚   â”‚
â”‚   â”œâ”€â”€ channels/
â”‚   â”‚   â”œâ”€â”€ base-channel.ts       # åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ ultrasonic-channel.ts # è¶…éŸ³æ³¢ãƒãƒ£ãƒãƒ«
â”‚   â”‚   â”œâ”€â”€ audible-channel.ts    # å¯è´éŸ³ãƒãƒ£ãƒãƒ«
â”‚   â”‚   â”œâ”€â”€ brightness-channel.ts # ç”»é¢æ˜æ»…ãƒãƒ£ãƒãƒ«
â”‚   â”‚   â”œâ”€â”€ color-channel.ts      # è‰²å¤‰èª¿ãƒãƒ£ãƒãƒ«
â”‚   â”‚   â”œâ”€â”€ grid-channel.ts       # ç©ºé–“ã‚°ãƒªãƒƒãƒ‰ãƒãƒ£ãƒãƒ«
â”‚   â”‚   â””â”€â”€ qr-channel.ts         # QRã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒãƒ«
â”‚   â”‚
â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”œâ”€â”€ store.ts              # çŠ¶æ…‹ç®¡ç†Store
â”‚   â”‚   â””â”€â”€ message-service.ts    # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ header.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ chat-area.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ signal-panel.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ control-area.ts
â”‚   â”‚   â”‚   â””â”€â”€ fullscreen-overlay.ts
â”‚   â”‚   â”œâ”€â”€ styles.ts             # CSSãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”‚   â””â”€â”€ renderer.ts           # DOMæ“ä½œãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ jsqr.ts               # jsQRã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–
â”‚   â”‚   â””â”€â”€ qrcode-generator.ts   # qrcode-generatorã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–
â”‚   â”‚
â”‚   â””â”€â”€ main.ts                   # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚
â”œâ”€â”€ dist/
â”‚   â””â”€â”€ index.html                # ãƒ“ãƒ«ãƒ‰å‡ºåŠ›ï¼ˆã‚·ãƒ³ã‚°ãƒ«HTMLï¼‰
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ build.ts                  # ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ update-libs.ts            # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ protocol.test.ts          # ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ bit-receiver.test.ts      # ãƒ“ãƒƒãƒˆå—ä¿¡ãƒ†ã‚¹ãƒˆ
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ Makefile
â”œâ”€â”€ requirements.md
â””â”€â”€ design.md
```

### 7.2 ãƒ“ãƒ«ãƒ‰å¾Œæ§‹æˆï¼ˆã‚·ãƒ³ã‚°ãƒ«HTMLãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Signal</title>
  <style>/* å…¨CSSã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ– */</style>
</head>
<body>
  <div id="app"></div>
  <script>
    /* jsQR ãƒ©ã‚¤ãƒ–ãƒ©ãƒª */
    /* qrcode-generator ãƒ©ã‚¤ãƒ–ãƒ©ãƒª */
    /* ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ */
  </script>
</body>
</html>
```

---

## 8. ãƒ“ãƒ«ãƒ‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### 8.1 ãƒ“ãƒ«ãƒ‰ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. TypeScript Compile                                            â”‚
â”‚    tsc --target ES2020 --module ES2020                          â”‚
â”‚    â†’ src/**/*.ts â†’ build/**/*.js                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Bundle                                                        â”‚
â”‚    esbuild src/main.ts --bundle --outfile=build/bundle.js       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Inline Libraries                                              â”‚
â”‚    jsQR 1.4.0 + qrcode-generator 1.4.4 ã‚’çµåˆ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Generate HTML                                                 â”‚
â”‚    template.html ã«CSSã€JSã‚’åŸ‹ã‚è¾¼ã¿                             â”‚
â”‚    â†’ dist/index.html                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Makefile

```makefile
.PHONY: all build clean test update-libs dev

all: build

build:
	npx tsc
	npx esbuild src/main.ts --bundle --outfile=build/bundle.js --target=es2020
	node scripts/build.js

clean:
	rm -rf build dist

test:
	npx vitest run

update-libs:
	node scripts/update-libs.js

dev:
	npx esbuild src/main.ts --bundle --outfile=dev/bundle.js --servedir=dev --watch
```

### 8.3 tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ES2020",
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "outDir": "./build",
    "rootDir": "./src",
    "declaration": true,
    "sourceMap": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"]
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "build", "dist", "tests"]
}
```

### 8.4 package.json

```json
{
  "name": "signal",
  "version": "1.0.0",
  "description": "ç‰©ç†ä¿¡å·ã‚’ä½¿ã£ãŸã‚ªãƒ•ãƒ©ã‚¤ãƒ³é€šä¿¡ã‚¢ãƒ—ãƒª",
  "type": "module",
  "scripts": {
    "build": "make build",
    "dev": "make dev",
    "test": "vitest run",
    "test:watch": "vitest",
    "clean": "make clean"
  },
  "devDependencies": {
    "typescript": "^5.9.3",
    "esbuild": "^0.20.0",
    "vitest": "^1.0.0"
  }
}
```

---

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

### 9.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡

| ã‚«ãƒ†ã‚´ãƒª | ã‚¨ãƒ©ãƒ¼å‹ | ç™ºç”Ÿç®‡æ‰€ | å¯¾å‡¦ |
|---------|---------|---------|------|
| Permission | PermissionDeniedError | getUserMedia | UIã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€å—ä¿¡åœæ­¢ |
| Protocol | ChecksumError | Protocol.decode | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã€å—ä¿¡ç¶™ç¶š |
| Protocol | DecodeError | Protocol.decode | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã€å—ä¿¡ç¶™ç¶š |
| Protocol | MessageTooLongError | Protocol.encode | é€ä¿¡ãƒ–ãƒ­ãƒƒã‚¯ã€UIã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º |
| Timeout | ReceiveTimeoutError | BitReceiver | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã€çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ |
| Device | DeviceNotFoundError | getUserMedia | UIã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º |
| Browser | APINotSupportedError | åˆæœŸåŒ–æ™‚ | UIã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º |

### 9.2 ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼éšå±¤

```typescript
abstract class SignalError extends Error {
  abstract readonly code: string;
  abstract readonly userMessage: string;
}

class PermissionDeniedError extends SignalError {
  readonly code = 'PERMISSION_DENIED';
  readonly userMessage = 'ãƒã‚¤ã‚¯/ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸ';
}

class ChecksumError extends SignalError {
  readonly code = 'CHECKSUM_ERROR';
  readonly userMessage = 'ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ';
}

class MessageTooLongError extends SignalError {
  readonly code = 'MESSAGE_TOO_LONG';
  readonly userMessage = 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ200ãƒã‚¤ãƒˆã‚’è¶…ãˆã¦ã„ã¾ã™';
}

class ReceiveTimeoutError extends SignalError {
  readonly code = 'RECEIVE_TIMEOUT';
  readonly userMessage = 'å—ä¿¡ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ';
}

class DeviceNotFoundError extends SignalError {
  readonly code = 'DEVICE_NOT_FOUND';
  readonly userMessage = 'ãƒã‚¤ã‚¯/ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
}

class APINotSupportedError extends SignalError {
  readonly code = 'API_NOT_SUPPORTED';
  readonly userMessage = 'ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“';
}
```

### 9.3 ãƒªã‚«ãƒãƒªãƒ¼ãƒ•ãƒ­ãƒ¼

```
Permission Error:
  â””â”€â–º å—ä¿¡ãƒ¢ãƒ¼ãƒ‰åœæ­¢
      â””â”€â–º ãƒ¡ãƒ‡ã‚£ã‚¢ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
          â””â”€â–º ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
              â””â”€â–º idleçŠ¶æ…‹ã¸

Checksum Error:
  â””â”€â–º "fail!" ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
      â””â”€â–º ãƒ“ãƒƒãƒˆãƒãƒƒãƒ•ã‚¡ãƒªã‚»ãƒƒãƒˆ
          â””â”€â–º å—ä¿¡ç¶™ç¶šï¼ˆæ¬¡ã®ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆå¾…æ©Ÿï¼‰

Timeout Error:
  â””â”€â–º "timeout" ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
      â””â”€â–º ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’idleã¸ãƒªã‚»ãƒƒãƒˆ
          â””â”€â–º å—ä¿¡ç¶™ç¶šï¼ˆæ¬¡ã®ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆå¾…æ©Ÿï¼‰
```

### 9.4 ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

```typescript
class ErrorHandler {
  handle(error: unknown): void {
    if (error instanceof SignalError) {
      this.showUserMessage(error.userMessage);
      this.logError(error);
    } else if (error instanceof Error) {
      this.showUserMessage('äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      this.logError(error);
    }
  }

  private showUserMessage(message: string): void {
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
    store.setState(prev => ({
      ...prev,
      receiverStatus: { state: 'error', message }
    }));
  }

  private logError(error: Error): void {
    console.error(`[Signal Error] ${error.message}`, error);
  }
}
```

---

## 10. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### 10.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

```typescript
// Protocol Tests
describe('Protocol', () => {
  describe('encode', () => {
    it('should encode ASCII message correctly', () => {
      const bits = Protocol.encode('Hi');
      expect(bits.length).toBeGreaterThan(24); // preamble + marker + length + data + checksum
    });

    it('should encode Japanese message correctly', () => {
      const bits = Protocol.encode('ã“ã‚“ã«ã¡ã¯');
      const decoded = Protocol.decode(bits);
      expect(decoded).toBe('ã“ã‚“ã«ã¡ã¯');
    });

    it('should encode emoji correctly', () => {
      const bits = Protocol.encode('ğŸ‘‹');
      const decoded = Protocol.decode(bits);
      expect(decoded).toBe('ğŸ‘‹');
    });

    it('should throw error for message > 200 bytes', () => {
      const longMessage = 'a'.repeat(201);
      expect(() => Protocol.encode(longMessage)).toThrow(MessageTooLongError);
    });

    it('should include correct preamble 10101010', () => {
      const bits = Protocol.encode('A');
      expect(bits.slice(0, 8)).toEqual([1, 0, 1, 0, 1, 0, 1, 0]);
    });

    it('should include correct start marker 11111111', () => {
      const bits = Protocol.encode('A');
      expect(bits.slice(8, 16)).toEqual([1, 1, 1, 1, 1, 1, 1, 1]);
    });

    it('should calculate correct checksum', () => {
      const bits = Protocol.encode('AB');
      // 'A' = 65, 'B' = 66, XOR = 3
      const decoded = Protocol.decode(bits);
      expect(decoded).toBe('AB');
    });
  });

  describe('decode', () => {
    it('should decode valid bit array', () => {
      const original = 'Hello';
      const bits = Protocol.encode(original);
      const decoded = Protocol.decode(bits);
      expect(decoded).toBe(original);
    });

    it('should return null for invalid checksum', () => {
      const bits = Protocol.encode('test');
      bits[bits.length - 1] ^= 1; // æœ€å¾Œã®ãƒ“ãƒƒãƒˆã‚’åè»¢
      expect(Protocol.decode(bits)).toBeNull();
    });

    it('should return null if start marker not found', () => {
      const bits = [0, 0, 0, 0, 0, 0, 0, 0]; // é–‹å§‹ãƒãƒ¼ã‚«ãƒ¼ãªã—
      expect(Protocol.decode(bits)).toBeNull();
    });

    it('should handle multi-byte UTF-8 correctly', () => {
      const original = 'Hello, ä¸–ç•Œ! ğŸ‘‹';
      const bits = Protocol.encode(original);
      const decoded = Protocol.decode(bits);
      expect(decoded).toBe(original);
    });
  });

  describe('roundtrip', () => {
    it('should encode and decode correctly', () => {
      const testCases = ['A', 'Hello', 'ã“ã‚“ã«ã¡ã¯', 'ğŸ‰ğŸŠ', 'Mixed æ—¥æœ¬èª and emoji ğŸ‘'];
      testCases.forEach(original => {
        const bits = Protocol.encode(original);
        const decoded = Protocol.decode(bits);
        expect(decoded).toBe(original);
      });
    });
  });
});

// BitReceiver Tests
describe('BitReceiver', () => {
  let receiver: BitReceiver;
  let mockCallbacks: ReceiverCallbacks;

  beforeEach(() => {
    mockCallbacks = {
      onMessage: vi.fn(),
      onError: vi.fn(),
      onStatusChange: vi.fn(),
    };
    receiver = new BitReceiver(mockCallbacks);
  });

  it('should transition from idle to pilot on pilot detection', () => {
    receiver.processPilotDetected(true);
    expect(receiver.getState()).toBe('pilot');
  });

  it('should transition from pilot to gap when pilot ends', () => {
    receiver.processPilotDetected(true);
    receiver.processPilotDetected(false);
    expect(receiver.getState()).toBe('gap');
  });

  it('should transition from gap to bits after gap duration', async () => {
    receiver.processPilotDetected(true);
    receiver.processPilotDetected(false);
    await sleep(200); // GAP_MS Ã— 0.6 ä»¥ä¸Š
    receiver.tick();
    expect(receiver.getState()).toBe('bits');
  });

  it('should accumulate bits correctly', () => {
    // çŠ¶æ…‹ã‚’bitsã«é·ç§»ã•ã›ã¦ã‹ã‚‰ãƒ“ãƒƒãƒˆã‚’è¿½åŠ 
    receiver.setState('bits');
    receiver.addBit(1);
    receiver.addBit(0);
    receiver.addBit(1);
    expect(receiver.getBits()).toEqual([1, 0, 1]);
  });

  it('should timeout after 2000 bits', () => {
    receiver.setState('bits');
    for (let i = 0; i < 2001; i++) {
      receiver.addBit(i % 2);
    }
    expect(mockCallbacks.onError).toHaveBeenCalled();
    expect(receiver.getState()).toBe('idle');
  });

  it('should call onMessage callback on successful decode', () => {
    const bits = Protocol.encode('test');
    receiver.setState('bits');
    bits.forEach(bit => receiver.addBit(bit));
    receiver.tryDecode();
    expect(mockCallbacks.onMessage).toHaveBeenCalledWith('test');
  });

  it('should call onError callback on checksum error', () => {
    const bits = Protocol.encode('test');
    bits[bits.length - 1] ^= 1; // ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã‚’å£Šã™
    receiver.setState('bits');
    bits.forEach(bit => receiver.addBit(bit));
    receiver.tryDecode();
    expect(mockCallbacks.onError).toHaveBeenCalled();
  });
});
```

### 10.2 æ‰‹å‹•E2Eãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

| ãƒ†ã‚¹ãƒˆID | ã‚·ãƒŠãƒªã‚ª | æ‰‹é † | æœŸå¾…çµæœ |
|----------|---------|------|---------|
| E2E-001 | è¶…éŸ³æ³¢é€å—ä¿¡ | ç«¯æœ«Aã§ã€Œtestã€é€ä¿¡ã€ç«¯æœ«Bã§å—ä¿¡ | ç«¯æœ«Bã«ã€Œtestã€è¡¨ç¤º |
| E2E-002 | å¯è´éŸ³é€å—ä¿¡ | ç«¯æœ«Aã§ã€Œã“ã‚“ã«ã¡ã¯ã€é€ä¿¡ã€ç«¯æœ«Bã§å—ä¿¡ | ç«¯æœ«Bã«ã€Œã“ã‚“ã«ã¡ã¯ã€è¡¨ç¤º |
| E2E-003 | ç”»é¢æ˜æ»…é€å—ä¿¡ | ç«¯æœ«Aã§ã€Œ1234ã€é€ä¿¡ã€ç«¯æœ«Bã§å—ä¿¡ | ç«¯æœ«Bã«ã€Œ1234ã€è¡¨ç¤º |
| E2E-004 | è‰²å¤‰èª¿é€å—ä¿¡ | ç«¯æœ«Aã§çµµæ–‡å­—é€ä¿¡ã€ç«¯æœ«Bã§å—ä¿¡ | ç«¯æœ«Bã«çµµæ–‡å­—è¡¨ç¤º |
| E2E-005 | ã‚°ãƒªãƒƒãƒ‰é€å—ä¿¡ | ç«¯æœ«Aã§é•·æ–‡é€ä¿¡ã€ç«¯æœ«Bã§å—ä¿¡ | ç«¯æœ«Bã«é•·æ–‡è¡¨ç¤º |
| E2E-006 | QRé€å—ä¿¡ | ç«¯æœ«Aã§QRè¡¨ç¤ºã€ç«¯æœ«Bã§ã‚¹ã‚­ãƒ£ãƒ³ | ç«¯æœ«Bã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| E2E-007 | ãƒãƒ£ãƒãƒ«åˆ‡æ›¿ | å—ä¿¡ä¸­ã«ãƒãƒ£ãƒãƒ«åˆ‡æ›¿ | ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾ç¢ºèª |
| E2E-008 | 200ãƒã‚¤ãƒˆä¸Šé™ | 200ãƒã‚¤ãƒˆè¶…ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | ã‚¨ãƒ©ãƒ¼è¡¨ç¤º |
| E2E-009 | ãƒã‚¤ã‚ºè€æ€§ | é¨’ãŒã—ã„ç’°å¢ƒã§éŸ³å£°ãƒãƒ£ãƒãƒ« | å—ä¿¡æˆåŠŸç‡ç¢ºèª |
| E2E-010 | é€£ç¶šé€å—ä¿¡ | è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€£ç¶šé€å—ä¿¡ | å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ |

### 10.3 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npm run test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
npm test -- --coverage
```

---

## ä»˜éŒ²A. ãƒ—ãƒ­ãƒˆã‚³ãƒ«è©³ç´°

### A.1 ãƒ•ãƒ¬ãƒ¼ãƒ æ§‹é€ ï¼ˆQRä»¥å¤–ã®5ãƒãƒ£ãƒãƒ«å…±é€šï¼‰

```
[ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆä¿¡å·] â†’ [ã‚®ãƒ£ãƒƒãƒ—] â†’ [ãƒ—ãƒªã‚¢ãƒ³ãƒ–ãƒ«] â†’ [é–‹å§‹ãƒãƒ¼ã‚«ãƒ¼] â†’ [ãƒ‡ãƒ¼ã‚¿é•·] â†’ [ãƒ‡ãƒ¼ã‚¿æœ¬ä½“] â†’ [ãƒã‚§ãƒƒã‚¯ã‚µãƒ ]
```

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚µã‚¤ã‚º | å€¤ | èª¬æ˜ |
|------------|--------|-----|------|
| ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆä¿¡å· | 700 ms | ãƒãƒ£ãƒãƒ«ä¾å­˜ | é€šä¿¡é–‹å§‹ã®æ¤œå‡ºç”¨ |
| ã‚®ãƒ£ãƒƒãƒ— | 300 ms | ç„¡ä¿¡å· | ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆã¨ãƒ‡ãƒ¼ã‚¿ã®å¢ƒç•Œ |
| ãƒ—ãƒªã‚¢ãƒ³ãƒ–ãƒ« | 8 bits | `10101010` | ã‚¯ãƒ­ãƒƒã‚¯åŒæœŸç”¨ |
| é–‹å§‹ãƒãƒ¼ã‚«ãƒ¼ | 8 bits | `11111111` | ãƒ‡ãƒ¼ã‚¿é–‹å§‹ã®ç¢ºå®šãƒãƒ¼ã‚«ãƒ¼ |
| ãƒ‡ãƒ¼ã‚¿é•· | 8 bits | 0â€“200 | ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ã®ãƒã‚¤ãƒˆæ•° |
| ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ | N Ã— 8 bits | UTF-8ãƒã‚¤ãƒˆåˆ— | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡ |
| ãƒã‚§ãƒƒã‚¯ã‚µãƒ  | 8 bits | XOR | å…¨ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒˆã®æ’ä»–çš„è«–ç†å’Œ |

### A.2 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å®Ÿè£…

```typescript
class Protocol {
  private static readonly PREAMBLE = [1, 0, 1, 0, 1, 0, 1, 0];
  private static readonly START_MARKER = [1, 1, 1, 1, 1, 1, 1, 1];
  private static readonly MAX_BYTES = 200;

  static encode(message: string): number[] {
    const encoder = new TextEncoder();
    const bytes = encoder.encode(message);

    if (bytes.length > this.MAX_BYTES) {
      throw new MessageTooLongError();
    }

    const bits: number[] = [];

    // ãƒ—ãƒªã‚¢ãƒ³ãƒ–ãƒ«
    bits.push(...this.PREAMBLE);

    // é–‹å§‹ãƒãƒ¼ã‚«ãƒ¼
    bits.push(...this.START_MARKER);

    // ãƒ‡ãƒ¼ã‚¿é•· (8ãƒ“ãƒƒãƒˆã€MSBãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ)
    bits.push(...this.byteToBits(bytes.length));

    // ãƒ‡ãƒ¼ã‚¿æœ¬ä½“
    for (const byte of bytes) {
      bits.push(...this.byteToBits(byte));
    }

    // ãƒã‚§ãƒƒã‚¯ã‚µãƒ  (XOR)
    const checksum = bytes.reduce((acc, byte) => acc ^ byte, 0);
    bits.push(...this.byteToBits(checksum));

    return bits;
  }

  private static byteToBits(byte: number): number[] {
    const bits: number[] = [];
    for (let i = 7; i >= 0; i--) {
      bits.push((byte >> i) & 1);
    }
    return bits;
  }
}
```

### A.3 ãƒ‡ã‚³ãƒ¼ãƒ‰å®Ÿè£…

```typescript
class Protocol {
  static decode(bits: number[]): string | null {
    // é–‹å§‹ãƒãƒ¼ã‚«ãƒ¼ï¼ˆ8å€‹é€£ç¶šã®1ï¼‰ã‚’æ¢ã™
    const markerIndex = this.findStartMarker(bits);
    if (markerIndex === -1) return null;

    const dataStart = markerIndex + 8;

    // ãƒ‡ãƒ¼ã‚¿é•·ã‚’èª­ã¿å–ã‚‹
    const lengthBits = bits.slice(dataStart, dataStart + 8);
    if (lengthBits.length < 8) return null;
    const dataLength = this.bitsToNumber(lengthBits);

    // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚‹
    const dataBytes: number[] = [];
    let bitIndex = dataStart + 8;

    for (let i = 0; i < dataLength; i++) {
      const byteBits = bits.slice(bitIndex, bitIndex + 8);
      if (byteBits.length < 8) return null;
      dataBytes.push(this.bitsToNumber(byteBits));
      bitIndex += 8;
    }

    // ãƒã‚§ãƒƒã‚¯ã‚µãƒ æ¤œè¨¼
    const checksumBits = bits.slice(bitIndex, bitIndex + 8);
    if (checksumBits.length < 8) return null;
    const receivedChecksum = this.bitsToNumber(checksumBits);
    const calculatedChecksum = dataBytes.reduce((acc, byte) => acc ^ byte, 0);

    if (receivedChecksum !== calculatedChecksum) return null;

    // UTF-8ãƒ‡ã‚³ãƒ¼ãƒ‰
    const decoder = new TextDecoder();
    return decoder.decode(new Uint8Array(dataBytes));
  }

  private static findStartMarker(bits: number[]): number {
    for (let i = 0; i <= bits.length - 8; i++) {
      if (bits.slice(i, i + 8).every(bit => bit === 1)) {
        return i;
      }
    }
    return -1;
  }

  private static bitsToNumber(bits: number[]): number {
    return bits.reduce((acc, bit) => (acc << 1) | bit, 0);
  }
}
```

---

## ä»˜éŒ²B. ãƒãƒ£ãƒãƒ«æ€§èƒ½å‚è€ƒå€¤

| ãƒãƒ£ãƒãƒ« | ç†è«–ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ | ã€Œã“ã‚“ã«ã¡ã¯ã€(15ãƒã‚¤ãƒˆ)ã®é€ä¿¡æ™‚é–“ |
|----------|------------------|----------------------------------|
| è¶…éŸ³æ³¢ | ~9.3 bps | ç´„17ç§’ |
| å¯è´éŸ³ | ~12.8 bps | ç´„12ç§’ |
| ç”»é¢æ˜æ»… | ~4.0 bps | ç´„40ç§’ |
| è‰²å¤‰èª¿ | ~3.6 bps | ç´„45ç§’ |
| ç©ºé–“ã‚°ãƒªãƒƒãƒ‰ | ~40 bps | ç´„4ç§’ |
| QR | ãƒãƒ¼ã‚¹ãƒˆ | ç´„3ç§’ï¼ˆè¡¨ç¤ºæ™‚é–“å›ºå®šï¼‰ |

â€» é€ä¿¡æ™‚é–“ã«ã¯ãƒ—ãƒªã‚¢ãƒ³ãƒ–ãƒ«ãƒ»é–‹å§‹ãƒãƒ¼ã‚«ãƒ¼ãƒ»ãƒã‚§ãƒƒã‚¯ã‚µãƒ ãƒ»ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆãƒ»ã‚®ãƒ£ãƒƒãƒ—ã®æ™‚é–“ã‚’å«ã‚€ã€‚

---

## ä»˜éŒ²C. ã‚°ãƒªãƒƒãƒ‰ãƒãƒ£ãƒãƒ«ç”¨ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°è©³ç´°

### C.1 ãƒ•ãƒ¬ãƒ¼ãƒ æ§‹é€ 

ã‚°ãƒªãƒƒãƒ‰ãƒãƒ£ãƒãƒ«ã¯ä»–ã®ãƒãƒ£ãƒãƒ«ã¨ç•°ãªã‚Šã€ãƒã‚¤ãƒˆå˜ä½ã®ãƒ•ãƒ¬ãƒ¼ãƒŸãƒ³ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

```
[Pilot: å…¨ç™½ 800ms] â†’ [Gap: å…¨é»’ 400ms] â†’ [Data Frames] â†’ [Checkerboard 500ms]

Data Frameæ§‹é€ :
  ãƒ•ãƒ¬ãƒ¼ãƒ 1: [ãƒ‡ãƒ¼ã‚¿é•·(1byte)][ãƒ‡ãƒ¼ã‚¿[0](1byte)]
  ãƒ•ãƒ¬ãƒ¼ãƒ 2: [ãƒ‡ãƒ¼ã‚¿[1](1byte)][ãƒ‡ãƒ¼ã‚¿[2](1byte)]
  ...
  ãƒ•ãƒ¬ãƒ¼ãƒ N: [ãƒ‡ãƒ¼ã‚¿[N-2](1byte)][ãƒã‚§ãƒƒã‚¯ã‚µãƒ (1byte)]
  â€» å¥‡æ•°ãƒã‚¤ãƒˆã®å ´åˆã¯0x00ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
```

### C.2 ã‚»ãƒ«â†’ãƒ“ãƒƒãƒˆãƒãƒƒãƒ”ãƒ³ã‚°

```
ã‚»ãƒ«é…ç½®:
  Row 0: [0][1][2][3]
  Row 1: [4][5][6][7]
  Row 2: [8][9][10][11]
  Row 3: [12][13][14][15]

High byte (ã‚»ãƒ«0-7):
  bit7=ã‚»ãƒ«0, bit6=ã‚»ãƒ«1, ..., bit0=ã‚»ãƒ«7

Low byte (ã‚»ãƒ«8-15):
  bit7=ã‚»ãƒ«8, bit6=ã‚»ãƒ«9, ..., bit0=ã‚»ãƒ«15
```

### C.3 ãƒã‚§ãƒƒã‚«ãƒ¼ãƒœãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³

```
çµ‚äº†ãƒãƒ¼ã‚«ãƒ¼:
  [â– ][â–¡][â– ][â–¡]
  [â–¡][â– ][â–¡][â– ]
  [â– ][â–¡][â– ][â–¡]
  [â–¡][â– ][â–¡][â– ]

åˆ¤å®š: (row + col) % 2 === 0 ãªã‚‰ç™½ã€1 ãªã‚‰é»’
75%ä»¥ä¸Šã®ä¸€è‡´ã§çµ‚äº†ã¨åˆ¤å®šï¼ˆç’°å¢ƒãƒã‚¤ã‚ºè€æ€§ï¼‰
```

---

## ä»˜éŒ²D. ä½¿ç”¨ãƒ–ãƒ©ã‚¦ã‚¶APIä¸€è¦§

| API | ç”¨é€” |
|-----|------|
| Web Audio APIï¼ˆAudioContext, OscillatorNode, AnalyserNodeï¼‰ | éŸ³å£°ã®ç”Ÿæˆãƒ»è§£æ |
| MediaDevices.getUserMedia({ audio }) | ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ |
| MediaDevices.getUserMedia({ video }) | ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ |
| Canvas 2D API | æ˜ åƒã®æç”»ãƒ»ãƒ”ã‚¯ã‚»ãƒ«è§£æãƒ»ä¿¡å·ã®å¯è¦–åŒ– |
| requestAnimationFrame | å—ä¿¡ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ |
| TextEncoder / TextDecoder | UTF-8ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ |
| performance.now() | é«˜ç²¾åº¦ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç®¡ç† |
| crypto.randomUUID() | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸IDç”Ÿæˆ |

---

## ä»˜éŒ²E. ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|------|------|
| FSK (Frequency Shift Keying) | å‘¨æ³¢æ•°ã®åˆ‡ã‚Šæ›¿ãˆã§ãƒ“ãƒƒãƒˆã‚’è¡¨ç¾ã™ã‚‹å¤‰èª¿æ–¹å¼ |
| ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆä¿¡å· | é€šä¿¡ã®é–‹å§‹ã‚’å—ä¿¡å´ã«çŸ¥ã‚‰ã›ã‚‹ãŸã‚ã®å›ºå®šå‘¨æ³¢æ•°/ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¿¡å· |
| ãƒ—ãƒªã‚¢ãƒ³ãƒ–ãƒ« | ãƒ‡ãƒ¼ã‚¿ã®ç›´å‰ã«ç½®ã‹ã‚Œã‚‹ã‚¯ãƒ­ãƒƒã‚¯åŒæœŸç”¨ã®ãƒ“ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ |
| ãƒã‚§ãƒƒã‚¯ã‚µãƒ  | ãƒ‡ãƒ¼ã‚¿ã®èª¤ã‚Šã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«ä»˜åŠ ã•ã‚Œã‚‹æ¤œè¨¼å€¤ |
| AnalyserNode | Web Audio APIã®ãƒãƒ¼ãƒ‰ã§ã€éŸ³å£°ä¿¡å·ã®FFTè§£æã‚’è¡Œã† |
| FFT (Fast Fourier Transform) | æ™‚é–“é ˜åŸŸã®ä¿¡å·ã‚’å‘¨æ³¢æ•°é ˜åŸŸã«å¤‰æ›ã™ã‚‹é«˜é€Ÿã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |
| BitReceiver | æœ¬ã‚¢ãƒ—ãƒªã§å®šç¾©ã™ã‚‹ãƒ“ãƒƒãƒˆå—ä¿¡ã®æ±ç”¨ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚¯ãƒ©ã‚¹ |
| ã‚¬ãƒ¼ãƒ‰åŒºé–“ | ãƒ“ãƒƒãƒˆé–“ã®å¹²æ¸‰ã‚’é˜²ããŸã‚ã®çŸ­ã„ç„¡ä¿¡å·æœŸé–“ |
| ã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | å—ä¿¡é–‹å§‹æ™‚ã«ç’°å¢ƒã®åŸºæº–å€¤ã‚’æ¸¬å®šã—ã€é–¾å€¤ã‚’å‹•çš„ã«è¨­å®šã™ã‚‹ã“ã¨ |
